<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Citas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
    <link rel="stylesheet" href="{{url_for('static', filename='css/style.css')}}">
    <link rel="icon" href="../static/IMG/Uñas-icono.png"> 
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">   
    
</head>
<body id="Citas">
    <div class="contenedor">
        <nav>
            <ul>
                <a href="#" class="logo">
                    <span class="nav-item">Agendar Citas</span>
                </a>
                <a href="{% if 'logueado' in session and session['logueado'] %}{% if session.get('id_rol') == 1 %}{{ url_for('admin') }}{% elif session.get('id_rol') == 2 %}{{ url_for('Empleado') }}{% elif session.get('id_rol') == 3 %}{{ url_for('Cliente') }}{% endif %}{% else %}{{ url_for('home') }}{% endif %}">
                    <i class="fas fa-home"></i>
                    <span class="nav-item">Home</span>
                </a>
                <a href="">
                    <i class="fas fa-user"></i>
                    <span class="nav-item">Citas</span>
                </a>
                {% if session['id_rol'] != 3 %}
                <a href="{{ url_for('inventario')}}">
                    <i class="fas fa-wallet"></i>
                    <span class="nav-item">Inventario</span>
                </a>
                <a href="{{ url_for('Registrar_Empleado')}}">
                    <i class="fas fa-tasks"></i>
                    <span class="nav-item">Agregar empleado</span>
                </a>
                {% endif %}
                <a href="{{ url_for('Home_Catalogo')}}">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-item">Catalogo</span>
                </a>
                <a href="{{ url_for('actualizar_cuenta')}}">
                    <i class="fas fa-cog"></i>
                    <span class="nav-item">Perfil</span>
                </a>
                <a href="{{ url_for('home')}}" class="logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="nav-item">Log out</span>
                </a>
            </ul>
        </nav>
        
        <main class="container mt-4">
            <br>
            <section>
                {% if session['id_rol'] == 1 %}
                    <h2>Lista de citas</h2>
                {% else %}
                    <h2>Lista de sus citas</h2>
                {% endif %}
            </section>
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">Nombre cliente</th>
                        <th scope="col">Servicio</th>
                        <th scope="col">Empleado</th>
                        <th scope="col">Fecha</th>
                        <th scope="col">Hora</th>
                        <th scope="col">Motivo</th>
                        {% if session['id_rol'] != 2 %}
                        <th scope="col">Acciones</th>
                        {% endif %}
                        {% if session['id_rol'] == 1 or session['id_rol'] == 2 %}
                        <th scope="col">Editar</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for cita in citas %}
                    <tr>
                        <td>{{ cita['nombre'] }}</td>
                        <td>{{ cita['servicio'] }}</td>
                        <td>{{ cita['empleado_nombre'] }}</td>
                        <td>{{ cita['fecha'] }}</td>
                        <td>{{ cita['hora'] }}</td>
                        <td>{{ cita['motivo'] }}</td>
                        {% if session['id_rol'] != 2 %}
                        <td>
                            <button onclick="confirmarEliminar('{{ cita['id_cita'] }}')" class="btn btn-danger btn-sm">Eliminar</button>
                        </td>
                        {% endif %}
                        {% if session['id_rol'] == 1 or session['id_rol'] == 2 %}
                        <td>
                            <button class="btn btn-warning btn-sm" data-toggle="modal" data-target="#modaledit{{ cita['id_cita'] }}">Editar</button>
                        </td>
                        {% endif %}
                    </tr>
                    <div id="modaledit{{ cita['id_cita'] }}" class="modal fade" role="dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title text-primary" style="align-content: center;">Detalles de la cita para editar</h5>
                                </div>
                                <div class="modal-body">
                                    <form action="{{ url_for('Citas') }}" method="POST">
                                        <input type="hidden" name="id_cita" value="{{ cita['id_cita'] }}">
                                        {% if session['id_rol'] == 2 %}
                                            <div class="form-group">
                                                <label>Fecha:</label>
                                                <input value="{{ cita['fecha'] }}" type="date" name="fecha" class="form-control">
                                            </div>
                                            <br>
                                            <div class="form-group">
                                                <label>Hora:</label>
                                                <input value="{{ cita['hora'] }}" type="time" name="hora" class="form-control">
                                            </div>
                                            <br>
                                        {% else %}
                                            <div class="form-group">
                                                <label>Nombre:</label>
                                                <input value="{{ cita['nombre'] }}" type="text" name="nombre" class="form-control">
                                            </div>
                                            <br>
                                            <div class="form-group">
                                                <label>Servicio:</label>
                                                <select name="servicio" class="form-control" id="servicio" required>
                                                    <option value="" selected>Selecciona el servicio</option>
                                                    {% for servicio in nombres_servicios %}
                                                        <option value="{{ servicio }}">{{ servicio }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <br>
                                            <div class="form-group">
                                                <label>Empleado:</label>
                                                <select name="empleado_nombre" class="form-control" id="empleado_nombre" required>
                                                    <option value="" selected>Selecciona el empleado</option>
                                                    {% for empleado in empleados_servicios %}
                                                        <option value="{{ empleado }}">{{ empleado }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <br>
                                            <div class="form-group">
                                                <label>Fecha:</label>
                                                <input value="{{ cita['fecha'] }}" type="date" name="fecha" class="form-control">
                                            </div>
                                            <br>
                                            <div class="form-group">
                                                <label>Hora:</label>
                                                <input value="{{ cita['hora'] }}" type="time" name="hora" class="form-control">
                                            </div>
                                            <br>
                                            <div class="form-group">
                                                <label>Motivo:</label>
                                                <input value="{{ cita['motivo'] }}" type="text" name="motivo" class="form-control">
                                            </div>
                                            <br>
                                        {% endif %}
                                        <button type="submit" class="btn btn-success">Actualizar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </tbody>
            </table>
            {% if session['id_rol'] == 1 %}
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalListaServicios">
                    Ver lista de servicios
                </button>
            {% endif %}
            <div class="modal fade" id="modalListaServicios" tabindex="-1" role="dialog" aria-labelledby="modalListaServiciosLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="modalListaServiciosLabel">Lista de Servicios</h5>
                        <span aria-hidden="true">&times;</span>
                    </button>
                    </div>
                    <div class="modal-body">

                    <ul>
                        {% for servicio in lista_servicios %}
                        <li>{{ servicio }}</li>
                        {% endfor %}
                    </ul>
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">Cerrar</button>
                    </div>
                </div>
                </div>
            </div>
            <br>
            <br>
            {% if session['id_rol'] == 1 %}
                <section>
                    <a href="#" class="btn btn-primary float-right" data-toggle="modal" data-target="#modalAgregarServicio">Agregar nuevo servicio</a>
                </section>
            {% endif %}
            <div id="modalAgregarServicio" class="modal fade" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Agregar nuevo servicio</h5>
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('agregar_servicio') }}" method="POST">
                                <div class="form-group">
                                    <label for="nombre_servicio">Nombre del Servicio:</label>
                                    <input type="text" name="nombre_servicio" class="form-control" id="nombre_servicio" required>
                                </div>
                                <br>
                                <div class="form-group">
                                    <label for="empleados_nombre">Empleado:</label>
                                    <select name="empleados_nombre" class="form-control" id="empleados_nombre" required>
                                        <option value="">Seleccione un empleado</option>
                                        {% for empleado in empleados_servicios %}
                                            <option value="{{ empleado }}">{{ empleado }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <br>
                                <button type="submit" class="btn btn-primary">Agregar</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            {% if session['id_rol'] != 2 %}
            <section>
                <a href="#" class="btn btn-primary float-right" data-toggle="modal" data-target="#myModal">Agregar nueva cita</a>
            </section>
            {% endif %}

            <!-- Resto del contenido de la página -->
            {% with messages = get_flashed_messages() %}
            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-success alert-dismissable" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="close">
                    <span aria-hidden="true">&times;</span>
                </button>
                {{ message }}
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}
            <br>
            <!-- Modal para agregar producto -->
            <div id="myModal" class="modal fade" role="dialog">
                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            {% if session['id_rol'] == 2 %}
                                {% else %}
                                <h5 class="modal-title text-primary">Ingresa una nueva cita</h5> 
                            {% endif %}
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('Registrar_Cita') }}" method="POST">
                                <div class="form-group">
                                    <label for="correo">Nombre:</label>
                                    <input type="text" name="nombre" class="form-control" id="nombre" required>
                                </div>
                                <br>
                                <div class="form-group">
                                    <label for="Servicio">Servicio:</label>
                                    <select name="servicio" class="form-select" required>
                                        <option value="" selected>Selecciona el servicio</option>
                                        {% for servicio in nombres_servicios %}
                                            <option value="{{ servicio }}">{{ servicio }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <br>
                                <div class="form-group">
                                    <label for="empleados_nombre">Empleado:</label>
                                    <select name="empleados_nombre" class="form-control" id="empleados_nombre" required>
                                        <option value="">Seleccione un empleado</option>
                                        {% for empleado in empleados_servicios %}
                                            <option value="{{ empleado }}">{{ empleado }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <br>
                                <div class="form-group">
                                    <label for="Fecha">Fecha:</label>
                                    <input type="date" name="Fecha" class="form-control" id="Fecha" required>
                                </div>
                                <br>
                                <div class="form-group">
                                    <label for="Hora">Hora:</label>
                                    <input type="time" name="Hora" class="form-control" id="Hora" required>
                                </div>
                                <br>
                                <div class="form-group">
                                    <label for="Motivo">Motivo:</label>
                                    <textarea name="motivo" required></textarea><br>
                                </div>
                                <br>
                                <button type="submit" class="btn btn-primary">Agendar</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            
        </main>

        <script>
            function confirmarEliminar(id) {
                if (confirm("¿Estás seguro de que quieres eliminar esta cita?")) {
                    eliminarCita(id);
                } else {
                    console.log("Eliminación cancelada por el usuario.");
                }
            }
        
            function eliminarCita(id) {
                fetch(`/eliminar_cita/${id}`, {
                    method: 'GET'
                })
                .then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        console.error('Error al eliminar la cita.');
                    }
                })
                .catch(error => {
                    console.error('Error de red:', error);
                });
            }
            
        </script>
        

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script> 
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>    
</body>
</html>